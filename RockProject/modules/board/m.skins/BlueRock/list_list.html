<load target="css/mboard.css"/>
<!--%import("js/bootstrap.min.js")-->

<nav class="navbar navbar-default navbar-fixed-top" >
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="true">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class = "navbar-brand" href="{$layout_info->index_url}"|cond="$layout_info->index_url" href="{geturl('')}"|cond="!$layout_info->index_url">
                <!--@if($layout_info->logo_image)-->
                    <img src="{$layout_info->logo_image}" alt="{$layout_info->index_title}"|cond="$layout_info->index_title" alt="{Context::getSiteTitle()}"|cond="!$layout_info->index_title && Context::getSiteTitle()" />
                <!--@elseif($layout_info->index_title)-->
                    <a href="{$layout_info->index_url}">{$layout_info->index_title}</a>
                <!--@elseif(Context::getSiteTitle())-->
                    {Context::getSiteTitle()}
                <!--@else-->
                    Mobile XE
                <!--@end-->
            </a>
        </div>
        <!--@if($main_menu != null) -->
            <div class="navbar-collapse collapse" id="bs-example-navbar-collapse-1" aria-expanded="true" style="">
                <ul class="nav navbar-nav navbar-right">
                    <!--@foreach($main_menu->list as $val1) -->
                        <!--@if($val1['list'])-->
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">{$val1['link']}<span class="caret"></span></a>
                                <ul class="dropdown-menu" role="menu">
                                    <li class="active"|cond="$val1['selected']">
                                        <a href="{$val1['href']}" target="_blank"|cond="$val1['open_window']=='Y'">{$val1['link']}</a>
                                    </li>
                                    <li class="divider"></li>
                                    <!--@foreach($val1['list'] as $val2)-->
                                        <li class="active"|cond="$val2['selected']">
                                            <a href="{$val2['href']}" target="_blank"|cond="$val2['open_window']=='Y'">{$val2['link']}</a>
                                        </li>
                                    <!--@end-->
                                </ul>
                            </li>
                        <!--@else-->
                            <li class="active"|cond="$val1['selected']">
                                <a href="{$val1['href']}" target="_blank"|cond="$val1['open_window']=='Y'">{$val1['link']}</a>
                            </li>
                        <!--@endif-->
                    <!--@end-->
                </ul>
            </div>
        <!--@endif-->
    </div>
</nav>
<br><br>
<h2 class="h2">
    <a href="{getUrl('','vid',$vid,'mid',$mid)}">{$module_info->browser_title}</a>
    <em>{number_format($total_count)}</em>
    <!--@if($module_info->use_category == "Y")-->
        <a href="{getUrl('page','','act','dispBoardCategory','')}" class="bn">{$lang->category}</a>
    <!--@endif-->
</h2>

<ul class="lt">
    <!-- 공지공지 -->
    <!--@if($page == 1) -->
        {@$cnt = 0}
    <!--@endif-->
    <!--@foreach($notice_list as $no => $document)-->
    <li>
        <a id="{$cnt}" class="main_button mb" name="{getUrl('document_srl', $document->document_srl,'Content_Num',$cnt)}">
            <span class="notice">{$lang->notice}</span>
            <span class="title">
                <!--@if($module_info->use_category == "Y" && $document->get('category_srl'))-->
                    {$category_list[$document->get('category_srl')]->title} &rsaquo;
                <!--@end-->
                <strong>{$document->getTitle($module_info->subject_cut_size)}</strong>
                <!--@if($document->getCommentCount())-->
                <span>[{$document->getCommentCount()}]</span>
                <!--@endif-->
            </span>
            <span class="auth"><em>{$document->getNickName()}</em>
                <span>{$document->getRegDate("Y.m.d")}</span>
            </span>
        </a>
        <div class="Notes" hidden="true" data-name="not-open">
        </div>
    </li>
    {@$cnt = $cnt + 1}
    <!--@end-->
    <!--@foreach($document_list as $no => $document)-->
    <li>
        <a id="{$cnt}" class="main_button mb" name="{getUrl('document_srl', $document->document_srl,'Content_Num',$cnt)}">
            <span class="title">
                {$no} &rsaquo;
                <!--@if($module_info->use_category == "Y" && $document->get('category_srl'))-->
                {$category_list[$document->get('category_srl')]->title} &rsaquo;
                <!--@end-->
                <strong>{$document->getTitle($module_info->subject_cut_size)}</strong>
                <!--@if($document->getCommentCount())-->
                <span>[{$document->getCommentCount()}]</span>
                <!--@endif-->
            </span>
            <span class="auth">
                <em>{$document->getNickName()}</em>
                <span>{$document->getRegDate("Y.m.d")}</span>
            </span>
        </a>
        <div class="Notes" hidden="true" data-name="not-open">
        </div>
    </li>
    {@$cnt = $cnt + 1}
    <!--@end-->
</ul>
<div class="page-{$page}" name="{getUrl('mid',$mid,'document_srl','','page',$page+1,'cnt',$cnt)}">

</div>

<!-- Page 부분 -->
<div class="cm">
    <a href="{getUrl('act','dispBoardWrite','document_srl','')}" class="bn">{$lang->cmd_write}</a>
</div>

<p class="debug"> Debug gap </p>

<ul class="ft">
    <!--@if($is_logged)-->
    <li class="fl"><a href="{getUrl('act','dispMemberLogout')}">{$lang->cmd_logout}</a></li>
    <li class="fl"><a href="{getUrl('act','dispMemberInfo')}">{$lang->cmd_view_member_info}</a></li>
    <!--@elseif($act!='dispMemberLoginForm')-->
    <li class="fl"><a href="{getUrl('act','dispMemberLoginForm')}">{$lang->cmd_login}...</a></li>
    <!--@end-->
    <li class="fr"><a href="{getUrl('m',0)}">PC</a></li>
    <li class="fr" cond="count($lang_supported)>1"><a href="{getUrl('act','dispModuleChangeLang','oldact',$act)}">LANG</a></li>
</ul>
<p class="cr">
    {$layout_info->index_title}
    <!--@if(!$layout_info->index_title)-->
    {Context::getSiteTitle()}
    <!--@end-->
</p>

    <script>
        jQuery(function($){
            $('.main_button').click(function() {
                $rak_str = '#Notes-' + this.id.toString();
                $rak_link = this.name.toString();
    //            $('p.debug').html('str = ' + $rak_str + '<br>' + 'link = ' + $rak_link);
    //            if($(this).next())
                $(this).next().toggle();
                $rak_name = $(this).next().data().name.toString();
                if ($rak_name === "not-open") {
                    $(this).next().load($rak_link);
                    $(this).next().data().name = "open";
                }else if($rak_name === "open"){
                    $(this).next().html("");
                    $(this).next().data().name = "not-open";
                }
            });

            function loadMore()
            {
                str = '.page-' + {$page};
                if ($(str).attr('name') != 'opened') {
                    go_str = $(str).attr('name').toString();
                    $(str).load(go_str);
                    $(str).attr('name','opened');
                }
            }

            function bindScroll(){
                if($(window).scrollTop() + $(window).height() > $(document).height() - 100) {
                    $(window).unbind('scroll');
                    loadMore();
                }
            }
            if($(window).scrollTop() + $(window).height() > $(document).height() - 100) {
                $(window).unbind('scroll');
                loadMore();
            }
            $(window).scroll(bindScroll);
        });
    </script>