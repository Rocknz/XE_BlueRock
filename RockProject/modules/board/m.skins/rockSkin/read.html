<load target="js/mboard.js" />
<load target="css/mboard.css" />

<div class="rd">
    <div class="co">
        <!--@if($oDocument->isSecret() && !$oDocument->isGranted())-->
            <div class="secretContent">
                <form action="./" method="get" onsubmit="return procFilter(this, input_password)">
                <input type="hidden" name="mid" value="{$mid}" />
                <input type="hidden" name="page" value="{$page}" />
                <input type="hidden" name="document_srl" value="{$oDocument->document_srl}" />
                    <div class="title">{$lang->msg_is_secret}</div>
                    <div class="content">
                        <input type="password" name="password" id="cpw" /><input type="submit" value="{$lang->cmd_input}" />
                    </div>

                </form>
            </div>
        <!--@else-->
            <!--@if($oDocument->isExtraVarsExists())-->
            {@ $_extra_vars = $oDocument->getExtraVars(); }
                <dl class="xv">
                <!--@foreach($_extra_vars as $key => $val)-->
                    <dt>{$val->name}</dt>
                    <dd>{$val->getValueHTML()}</dd>
                <!--@end-->
                </dl>
            <!--@end-->
            {$oDocument->getContent(false)}
        <!--@end-->
    </div>
    <!--@if($oDocument->hasUploadedFiles())-->
    {@ $uploaded_list = $oDocument->getUploadedFiles() }
    <h3 class="h3">{$lang->uploaded_file} <em>[{count($uploaded_list)}]</em> <button type="button" class="tg tg{$Content_Num}" title="open/close"></button></h3>
    <ul class="sn tgo{$Content_Num} open">
        <!--@foreach($uploaded_list as $key => $file)-->
        <li><a href="{getUrl('')}{$file->download_url}">{$file->source_filename}</a></li>
        <!--@end-->
    </ul>
    <!--@endif-->
    <!--@if($oDocument->allowTrackback() && $oDocument->getTrackbackCount())-->
    <h3 class="h3">{$lang->trackback} <em>[{$oDocument->getTrackbackCount()}]</em> <button type="button" class="tg tg{$Content_Num}" title="open/close"></button></h3>
    <ul class="rp tgo{$Content_Num} open">
        {@ $_trackback_list = $oDocument->getTrackbacks() }
        <!--@foreach($_trackback_list as $key => $val)-->
        <li>
            <p>{$val->excerpt}</p>
            <em>{htmlspecialchars($val->title)} - {htmlspecialchars($val->blog_name)}</em>
            <span>zdate($val->regdate, "Y.m.d")</span>
            <!--@if($grant->manager)-->
            <a href="07_password.html" class="md">삭제</a>
            <!--@endif-->
        </li>
        <!--@end-->
    </ul>
    <!--@endif-->

    <!--이부분 부터 코맨트.  tg -> toggle input 이고, tgo -> toggle input을 받았을때 사라지는 부분. -->
    <!--@if($oDocument->getCommentCount())-->
    <h3 class="h3" id="clb{$Content_Num}">{$lang->comment} <em>[{$oDocument->getCommentCount()}]</em>
        <button type="button" class="tg tg{$Content_Num} tgr{$Content_Num} " title="open/close">

        </button>
    </h3>
    <div id="Comment_Set{$Content_Num}" class="tgo{$Content_Num}" hidden="true" >

    </div>
    <!--@endif-->

    <!--@if($grant->write_comment && $oDocument->isEnableComment() )-->
    <h3 class="h3">
        {$lang->write_comment}
        <button type="button" class="tg tg{$Content_Num}" title="open/close"/>
    </h3>

    <form action="./" method="POST" class="sn tgo{$Content_Num} open" onsubmit="return procFilter(this, insert_comment);" hidden="true">
        <input type="hidden" name="mid" value="{$mid}" />
        <input type="hidden" name="document_srl" value="{$oDocument->document_srl}" />
        <input type="hidden" name="comment_srl" value="" />
        <ul>
            <li>
                <label for="rText" class="db fb">{$lang->comment}</label>
                <textarea name="content" rows="8" cols="42" id="rText" class="itxx"></textarea>
            </li>
            <!--@if(!$is_logged)-->
            <li>
                <label for="uName" class="db fb">{$lang->writer}</label>
                <input name="nick_name" type="text" id="uName" class="itx" />
            </li>
            <li>
                <label for="uMail" class="db fb">{$lang->email_address}</label>
                <input name="email_address" type="email" id="uMail" class="itx" />
            </li>
            <li>
                <label for="uPw" class="db fb">{$lang->password}</label>
                <input name="password" type="password" id="uPw" class="itx" />
            </li>
            <li>
                <label for="uSite" class="db fb">{$lang->homepage}</label>
                <input name="homepage" type="url" id="uSite" class="itx" value="" />
            </li>
            <!--@endif-->
        </ul>
        <div class="ar">
            <input name="" type="submit" value="{$lang->cmd_comment_registration}" />
        </div>
    </form>
    <!--@end-->
</div>
<script>
    Query(function($){
        $str = '.tg'+'{$Content_Num}';
        $($str).click(function(){
            $('p.debug').html("click");
            $(this).next('.tgo'+'{$Content_Num}').toggle();
        });
        $str2 = '.tgr'+'{$Content_Num}';
        $($str2).click(function(){
            {@ $lastpage = 1; }
            {@ $temp = $oDocument->getComments() }
            <!--@if($oDocument->comment_page_navigation)-->
            {@ $lastpage = $oDocument->comment_page_navigation->last_page }
            <!--@endif-->
            loadCommentPage({$oDocument->document_srl}, {$lastpage}, {$Content_Num});
        });

        function loadCommentPage(document_srl, page, Content_Num)
        {
            var params = {};
            params.cpage = page;
            params.document_srl = document_srl;
            params.mid = current_mid;
            params.Content_Num = Content_Num;
            jQuery.exec_json('board.getBoardCommentPage', params, completeCommentGetPage);
        }

        function completeCommentGetPage(ret_val)
        {
            jQuery("#Comment_Set{$Content_Num}").html(ret_val.html);
        }
    });

    //<![CDATA[
    //]]>
</script>
